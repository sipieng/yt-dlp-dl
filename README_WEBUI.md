# yt-dlp Web UI

基于Flask的Web界面，为yt-dlp提供图形化操作界面。支持解析视频格式、选择下载质量、自定义文件名等功能。

## 功能特性

1. **URL解析**：输入视频URL，自动获取所有可用格式（视频、音频、字幕）
2. **下载模式**：
   - **默认最佳质量**：自动选择最佳画质和音质（yt-dlp默认逻辑）
   - **自定义选择**：手动选择具体的视频、音频、字幕格式
3. **下载选项**：
   - 自定义文件名（留空使用视频原标题）
   - 选择输出容器格式（MP4/MKV/WebM或自动选择）
   - 下载路径配置（默认：`./downloads/`）
4. **实时进度**：显示下载进度、速度和预计完成时间
5. **文件管理**：下载完成后提供直接下载链接

## 系统要求

- Python 3.13+
- yt-dlp 2025.12.8+
- Flask 3.0+

## 安装与运行

### 1. 安装依赖

项目使用[UV](https://github.com/astral-sh/uv)管理Python依赖。确保已安装UV，然后运行：

```bash
# 同步依赖（会自动安装Flask和yt-dlp）
uv sync
```

### 2. 启动Web UI

#### Windows用户：
```bash
# 方法1：使用批处理文件
run.bat

# 方法2：直接运行Python脚本
uv run python run.py

# 方法3：直接运行app.py
uv run python app.py
```

#### macOS/Linux用户：
```bash
# 方法1：使用Python脚本
uv run python run.py

# 方法2：直接运行app.py
uv run python app.py
```

### 3. 访问Web界面

服务器启动后，在浏览器中打开：  
👉 **[http://127.0.0.1:5000](http://127.0.0.1:5000)**

## 使用指南

### 基本流程

1. **输入视频URL**
   - 在输入框中粘贴YouTube或其他支持网站的视频链接
   - 示例：`https://m.youtube.com/watch?v=ZEjLaSf4cCA`

2. **解析格式**
   - 点击"解析格式"按钮
   - 系统将获取视频信息和所有可用格式
   - 解析成功后显示视频标题、时长和格式数量

3. **选择下载模式**
   - **默认最佳质量**：自动选择最佳画质和音质（推荐大多数用户）
   - **自定义选择**：手动选择具体的视频、音频、字幕格式
     - 点击"视频格式"、"音频格式"、"字幕格式"标签页查看
     - 单选视频和音频格式，可选字幕格式

4. **配置下载选项**
   - 自定义文件名（可选）
   - 下载路径（默认：`./downloads/`）
   - 容器格式（自动/MP4/MKV/WebM）

5. **开始下载**
   - 点击"开始下载"按钮
   - 系统将在后台下载视频
   - 页面显示实时进度、下载速度和预计完成时间

6. **完成下载**
   - 下载完成后显示"下载完成"消息
   - 点击"下载文件"链接保存到本地

### 界面详解

#### 1. URL输入区
- 输入框：粘贴视频链接
- 解析按钮：获取视频信息和格式列表
- 清空按钮：重置当前选择

#### 2. 视频信息区（解析后显示）
- 视频标题
- 时长和格式数量统计

#### 3. 格式选择区（自定义模式）
- **视频格式**：显示分辨率、编码、文件大小、码率
- **音频格式**：显示编码、采样率、文件大小、码率
- **字幕格式**：显示语言和格式（如有）

#### 4. 下载选项区
- **文件名**：自定义输出文件名（不含扩展名）
- **下载路径**：文件保存目录
- **容器格式**：输出文件格式

#### 5. 状态显示区
- 进度条：实时显示下载进度
- 状态消息：当前操作状态
- 下载链接：完成后提供文件下载

## 技术架构

### 项目结构
```
yt-dlp-dl/
├── app.py                    # Flask主应用
├── run.py                    # 启动脚本
├── run.bat                   # Windows启动脚本
├── services/
│   └── downloader.py         # yt-dlp下载器服务
├── templates/
│   └── index.html           # 主界面模板
├── static/
│   ├── css/
│   │   └── style.css        # 样式表
│   └── js/
│       └── script.js        # 前端交互逻辑
├── downloads/               # 下载文件存储目录
├── .gitignore              # Git忽略规则
├── pyproject.toml          # 项目配置
├── uv.lock                 # 依赖锁定
├── README.md               # 原始命令行使用说明
└── README_WEBUI.md         # Web UI使用说明（本文档）
```

### 后端API端点

| 端点 | 方法 | 功能 |
|------|------|------|
| `/` | GET | 渲染主页面 |
| `/api/parse` | POST | 解析URL，返回视频信息和格式列表 |
| `/api/download` | POST | 启动下载任务 |
| `/api/status/<task_id>` | GET | 查询下载任务状态 |
| `/downloads/<filename>` | GET | 下载已完成的文件 |
| `/health` | GET | 健康检查 |

### 前端技术
- **HTML5**：页面结构
- **CSS3**：响应式设计，现代化界面
- **JavaScript (ES6)**：异步交互，实时更新
- **无框架依赖**：原生实现，轻量高效

## 常见问题

### Q1: 解析视频时显示JavaScript运行时警告
```
WARNING: [youtube] No supported JavaScript runtime could be found...
```
**原因**：yt-dlp需要JavaScript运行时来解析某些YouTube格式。  
**解决方案**：安装一个JS运行时（如Deno）：
```bash
# 安装Deno（推荐）
uv add deno

# 或者使用已有Node.js
uv add nodejs
```
**注意**：即使没有JS运行时，大部分视频仍可正常下载，只是可能缺少某些格式。

### Q2: 下载速度慢或失败
**可能原因**：
1. 网络连接问题
2. 视频源限制
3. 防火墙或代理设置

**解决方案**：
- 检查网络连接
- 尝试不同的视频源
- 使用代理服务器（如果需要在特定地区访问）

### Q3: 文件保存位置
下载的文件默认保存在 `./downloads/` 目录下。  
可在Web界面中修改下载路径，或直接在服务器文件系统中访问该目录。

### Q4: 同时下载多个视频
当前版本设计为**单任务下载**，一次只能处理一个下载任务。  
这是为了防止服务器资源过载。下载完成后可开始新任务。

### Q5: 支持哪些视频网站？
支持所有yt-dlp支持的网站，包括：
- YouTube
- Bilibili
- 抖音
- Twitter
- TikTok
- 等1000+个网站

## 注意事项

1. **版权提醒**：请仅下载您有权下载的视频内容，遵守相关法律法规。
2. **资源使用**：视频下载会占用网络带宽和服务器存储空间。
3. **文件保留**：下载的文件永久保留在`downloads/`目录中，请定期清理。
4. **单任务限制**：同时只允许一个下载任务，避免服务器过载。
5. **错误处理**：如果下载失败，请检查错误信息并重试。

## 故障排除

### 无法启动Flask服务器
```bash
# 检查Python版本
python --version

# 检查依赖是否安装
uv pip list | grep -E "(flask|yt-dlp)"

# 检查端口占用
netstat -ano | findstr :5000  # Windows
lsof -i :5000                 # macOS/Linux
```

### 无法解析某些视频
```bash
# 更新yt-dlp到最新版本
uv add "yt-dlp@latest"

# 检查视频URL是否有效
```

### 下载进度不更新
- 刷新页面重新连接
- 检查浏览器控制台是否有JavaScript错误
- 重启Flask服务器

## 更新日志

### v1.0.0 (2025-02-02)
- 初始版本发布
- 基本视频解析和下载功能
- 默认/自定义下载模式
- 实时进度显示
- 响应式Web界面

## 开发者说明

### 扩展功能建议
1. 多任务下载队列
2. 批量URL处理
3. 下载历史记录
4. 用户认证系统
5. 移动端优化
6. 更多视频平台支持

### 贡献代码
1. Fork本仓库
2. 创建功能分支
3. 提交更改
4. 发起Pull Request

## 许可证

本项目基于MIT许可证开源。详见LICENSE文件。

## 支持与反馈

如有问题或建议，请：
1. 查看[原始README.md](README.md)中的命令行用法
2. 提交GitHub Issue
3. 联系我们获取支持

---
**Happy downloading! 🎬**